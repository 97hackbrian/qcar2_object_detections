# =============================================================================
# QCar2 Object Detections - Configuration Parameters
# =============================================================================
# Load with:
#   ros2 launch qcar2_object_detections qcar2_detections.launch.py
#     --params-file /path/to/detections_params.yaml
# =============================================================================

# =============================================================================
# Image Preprocessor Node
# =============================================================================
image_preprocessor_node:
  ros__parameters:
    input_image_topic: "/camera/color_image"
    output_image_topic: "/image"

    input_width: 640
    input_height: 480

    target_width: 640
    target_height: 640

    padding_color: [0, 0, 0]
    input_encoding: "bgr8"


# =============================================================================
# Detection Filter Node
# =============================================================================
detection_filter_node:
  ros__parameters:
    # -------------------------------------------------------------------------
    # Input Topics
    # -------------------------------------------------------------------------
    image_topic: "/image"
    detections_input_topic: "/detections_output"
    zebra_image_topic: "/camera/csi_image_3"

    # -------------------------------------------------------------------------
    # Output Topics
    # -------------------------------------------------------------------------
    person_output_topic: "/detections/person"
    traffic_light_output_topic: "/detections/traffic_light"
    stop_sign_output_topic: "/detections/stop_sign"
    zebra_output_topic: "/detections/zebra_crossing"

    # -------------------------------------------------------------------------
    # COCO Class IDs
    # -------------------------------------------------------------------------
    person_class_id: "0"
    traffic_light_class_id: "9"
    stop_sign_class_id: "11"

    # -------------------------------------------------------------------------
    # ROIs (pixeles)
    # -------------------------------------------------------------------------
    person_roi: [0, 0, 640, 640]
    stop_sign_roi: [0, 0, 640, 640]

    # -------------------------------------------------------------------------
    # Confidence Threshold
    # -------------------------------------------------------------------------
    # ESTE (min_confidence) es el que tu detection_filter_node.py USA seguro.
    min_confidence: 0.70

    # Este (confidence_threshold) SOLO servirá si el nodo YOLO/TensorRT lee este
    # parámetro desde el mismo YAML (normalmente se pasa como launch arg).
    confidence_threshold: 0.70





    # -------------------------------------------------------------------------
    # PERSON
    # -------------------------------------------------------------------------
    person_roi_x_min: 0.45     # ROI vertical angosto al centro (en % del ancho)
    person_roi_x_max: 0.55
    person_roi_y_min: 0.35     # parte media-baja (en % del alto)
    person_roi_y_max: 0.98

    person_min_bbox_area: 1200  # ajusta: más alto = más cerca
    person_confirm_frames: 3    # estabilidad (igual que semáforo)
    person_debug_view: true
    person_window_name: "person_debug"






    # -------------------------------------------------------------------------
    # Zebra Crossing Detection Parameters
    # -------------------------------------------------------------------------
    zebra_enabled: true
    zebra_roi_top: 0.74
    zebra_roi_bottom: 0.955
    zebra_roi_width: 0.40
    zebra_min_stripes: 4
    zebra_max_stripes: 7
    zebra_vote_threshold: 5
    zebra_vote_window: 7

    # -------------------------------------------------------------------------
    # Traffic Light (IMPROVED)
    # -------------------------------------------------------------------------
    traffic_light_roi_x_min: 0.25
    traffic_light_roi_x_max: 0.65
    traffic_light_roi_y_min: 0.30
    traffic_light_roi_y_max: 0.60

    traffic_light_min_bbox_area: 600
    traffic_light_confirm_frames: 3
    traffic_light_debug_view: true
    traffic_light_sensitivity: 4 # mejroa la direfencia entre verde y amarillo

    # -------------------------------------------------------------------------
    # Traffic Light HSV Color Thresholds
    # -------------------------------------------------------------------------
    traffic_light_red_lower: [0, 160, 160]
    traffic_light_red_upper: [10, 255, 255]

    traffic_light_yellow_lower: [20, 30, 240]
    traffic_light_yellow_upper: [45, 160, 255]

    traffic_light_green_lower: [46, 140, 140]
    traffic_light_green_upper: [90, 255, 255]